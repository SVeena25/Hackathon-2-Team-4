{% extends 'base.html' %}
{% load i18n %}
{% load static %}

{% block meta_title %}{% trans "Change Password" %}{% endblock %}

{% block logo %}
    <div class="pt-3 m-3" style="width: 200px;">
        {% include 'components/dynamic_icons/6x_labs_logo.svg' %}
    </div>
{% endblock logo %}

{% block content %}
    {% if token_fail %}
        <h1 class="display-4 fw-bold pb-3">{% trans "Invalid link" %}</h1>

        <div class="alert alert-danger" role="alert">
            <i class="bi bi-exclamation-triangle me-2"></i>
            {% trans "The password reset link was invalid, possibly because it has already been used." %}
        </div>

        <p class="text-muted pb-3">
            {% trans "Please request a new password reset." %}
        </p>

        <a href="{% url 'account_reset_password' %}" class="btn-auth" style="text-decoration: none;">
            {% trans "Request new reset link" %}
        </a>
    {% else %}
        <h1 class="display-4 fw-bold pb-3">{% trans "Set new password" %}</h1>

        <form method="post" action="{{ action_url }}">
            {% csrf_token %}
            {{ redirect_field }}

            <!-- Form-level errors -->
            {% if form.non_field_errors %}
                <div class="alert alert-danger" role="alert">
                    {% for error in form.non_field_errors %}
                        {{ error }}
                    {% endfor %}
                </div>
            {% endif %}

            <!-- New Password field -->
            <label for="id_password1">{% trans "New password" %}</label>
            <div class="input-auth-wrapper">
                <input type="password"
                       id="id_password1"
                       name="password1"
                       class="input-auth {% if form.password1.errors %}is-invalid{% endif %}"
                       placeholder=" "
                       required>
                <button type="button" class="input-clear" onclick="this.previousElementSibling.value=''; this.previousElementSibling.focus();">
                    <i class="bi bi-x"></i>
                </button>
            </div>
            {% if form.password1.errors %}
                <div class="text-danger small">{{ form.password1.errors.0 }}</div>
            {% endif %}

            <!-- Confirm Password field -->
            <label for="id_password2">{% trans "Confirm new password" %}</label>
            <div class="input-auth-wrapper">
                <input type="password"
                       id="id_password2"
                       name="password2"
                       class="input-auth {% if form.password2.errors %}is-invalid{% endif %}"
                       placeholder=" "
                       required>
                <button type="button" class="input-clear" onclick="this.previousElementSibling.value=''; this.previousElementSibling.focus();">
                    <i class="bi bi-x"></i>
                </button>
            </div>
            {% if form.password2.errors %}
                <div class="text-danger small">{{ form.password2.errors.0 }}</div>
            {% endif %}

            <button type="submit" name="action" class="btn-auth">{% trans "Change password" %}</button>
        </form>

        <div class="pb-3 text-muted">
            <a href="{% url 'account_login' %}">{% trans "Cancel" %}</a>
        </div>
    {% endif %}

    {% if not cancel_url %}
        <form id="logout-from-stage" method="post" action="{% url 'account_logout' %}" style="display: none;">
            <input type="hidden" name="next" value="{% url 'account_login' %}">
            {% csrf_token %}
        </form>
    {% endif %}
{% endblock content %}

{% block footer %}
    <p class="pt-3 text-muted small">{% trans "Choose a strong password with at least 8 characters." %}</p>
{% endblock footer %}
